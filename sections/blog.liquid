{% comment %}
  Blog section - displays blog articles in a 3-column grid with SEO section.
  Used as the main section for the blog template.
{% endcomment %}

{%- liquid
  assign articles_per_page = 6
-%}

<section class="blog full-width" aria-label="{{ 'sections.blog.aria_label' | t }}">
  <div class="blog__wrapper">
    <h1 class="blog__heading">{{ blog.title }}</h1>

    {% paginate blog.articles by articles_per_page %}
      {%- if blog.articles.size > 0 -%}
        <div class="blog__grid">
          {%- for article in blog.articles -%}
            {%- assign should_lazy_load = true -%}
            {%- if forloop.index <= 3 -%}
              {%- assign should_lazy_load = false -%}
            {%- endif -%}
            <div class="blog__card">
              {% render 'blog-card',
                article: article,
                lazy_load: should_lazy_load
              %}
            </div>
          {%- endfor -%}
        </div>
      {%- else -%}
        <p class="blog__empty">{{ 'blog.no_articles' | t }}</p>
      {%- endif -%}

      {%- if paginate.pages > 1 -%}
        <nav class="blog__pagination" aria-label="{{ 'pagination.navigation' | t }}">
          <ul class="blog__pagination-list">
            {%- if paginate.previous -%}
              <li class="blog__pagination-item">
                <a href="{{ paginate.previous.url }}" class="blog__pagination-link blog__pagination-link--prev" aria-label="{{ 'general.previous' | t }}">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                    <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              </li>
            {%- endif -%}

            {%- for part in paginate.parts -%}
              <li class="blog__pagination-item">
                {%- if part.is_link -%}
                  <a href="{{ part.url }}" class="blog__pagination-link">{{ part.title }}</a>
                {%- else -%}
                  {%- if part.title == paginate.current_page -%}
                    <span class="blog__pagination-link blog__pagination-link--current" aria-current="page">{{ part.title }}</span>
                  {%- else -%}
                    <span class="blog__pagination-link blog__pagination-link--ellipsis">{{ part.title }}</span>
                  {%- endif -%}
                {%- endif -%}
              </li>
            {%- endfor -%}

            {%- if paginate.next -%}
              <li class="blog__pagination-item">
                <a href="{{ paginate.next.url }}" class="blog__pagination-link blog__pagination-link--next" aria-label="{{ 'general.next' | t }}">
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                    <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              </li>
            {%- endif -%}
          </ul>
        </nav>
      {%- endif -%}
    {% endpaginate %}

    {%- if section.settings.seo_heading != blank or section.settings.seo_text != blank -%}
      <div class="blog__seo">
        <div class="blog__seo-inner">
          {%- if section.settings.seo_heading != blank -%}
            <h2 class="blog__seo-heading">{{ section.settings.seo_heading | escape }}</h2>
          {%- endif -%}
          {%- if section.settings.seo_text != blank -%}
            <div class="blog__seo-text">{{ section.settings.seo_text }}</div>
          {%- endif -%}
        </div>
      </div>
    {%- endif -%}

    </div>
</section>

{%- comment -%} Schema markup for blog listing {%- endcomment -%}
{%- if blog.articles.size > 0 -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": {{ blog.title | json }},
    "itemListElement": [
      {%- for article in blog.articles limit: articles_per_page -%}
        {
          "@type": "ListItem",
          "position": {{ forloop.index }},
          "item": {
            "@type": "BlogPosting",
            "headline": {{ article.title | json }},
            "url": {{ article.url | prepend: request.origin | json }},
            "datePublished": "{{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' }}",
            "author": {
              "@type": "Person",
              "name": {{ article.author | json }}
            }
            {%- if article.image -%},
            "image": {{ article.image | image_url: width: 1200 | prepend: 'https:' | json }}
            {%- endif -%}
          }
        }{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ]
  }
  </script>
{%- endif -%}

{% stylesheet %}
  .blog {
    background-color: #FFF7EA;
    padding: 60px 0 80px;
    padding-top: calc(var(--total-header-height, 110px) + 60px);
  }

  .blog__wrapper {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0;
  }

  .blog__heading {
    font-family: var(--font-alyona);
    font-size: 50px;
    font-weight: 400;
    line-height: 1;
    text-align: center;
    color: #3E2027;
    margin: 0 0 60px;
  }

  .blog__grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }

  .blog__card {
    width: 100%;
  }

  .blog__empty {
    text-align: center;
    font-family: var(--font-jokker);
    font-size: 16px;
    color: #3E2027;
    padding: 60px 40px;
  }

  /* Pagination */
  .blog__pagination {
    display: flex;
    justify-content: center;
    margin-top: 60px;
  }

  .blog__pagination-list {
    display: flex;
    align-items: center;
    gap: 8px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .blog__pagination-item {
    display: flex;
  }

  .blog__pagination-link {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    padding: 8px 12px;
    font-family: var(--font-jokker);
    font-size: 14px;
    font-weight: 400;
    color: #3E2027;
    text-decoration: none;
    border: 1px solid transparent;
    transition: border-color 0.2s ease, background-color 0.2s ease;
  }

  .blog__pagination-link:hover {
    border-color: rgba(62, 32, 39, 0.3);
  }

  .blog__pagination-link:focus-visible {
    outline: 2px solid #3E2027;
    outline-offset: 2px;
  }

  .blog__pagination-link--current {
    font-weight: 600;
    border-color: #3E2027;
  }

  .blog__pagination-link--prev,
  .blog__pagination-link--next {
    min-width: 40px;
    padding: 8px;
  }

  .blog__pagination-link--ellipsis {
    cursor: default;
  }

  /* SEO Section */
  .blog__seo {
    margin-top: 80px;
    padding-top: 60px;
    border-top: 1px solid rgba(62, 32, 39, 0.2);
  }

  .blog__seo-inner {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .blog__seo-heading {
    font-family: var(--font-alyona);
    font-size: 40px;
    font-weight: 400;
    line-height: 1;
    color: #3E2027;
    margin: 0;
    max-width: 600px;
  }

  .blog__seo-text {
    font-family: var(--font-jokker);
    font-size: 18px;
    font-weight: 400;
    line-height: 1.5;
    color: #3E2027;
  }

  .blog__seo-text p {
    margin: 0 0 1em;
  }

  .blog__seo-text p:last-child {
    margin-bottom: 0;
  }

  /* Blog Card Styles */
  .blog-card {
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  .blog-card__link {
    display: flex;
    flex-direction: column;
    gap: 30px;
    text-decoration: none;
    color: inherit;
  }

  .blog-card__link:focus-visible {
    outline: 2px solid #3E2027;
    outline-offset: 4px;
  }

  .blog-card__image-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 440 / 569;
    overflow: hidden;
  }

  .blog-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .blog-card__link:hover .blog-card__image {
    transform: scale(1.02);
  }

  .blog-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(62, 32, 39, 0.05);
  }

  .blog-card__placeholder-icon {
    width: 60px;
    height: 60px;
  }

  .blog-card__content {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .blog-card__title {
    font-family: var(--font-sweet-sans);
    font-size: 20px;
    font-weight: 500;
    line-height: normal;
    letter-spacing: -0.2px;
    text-transform: uppercase;
    color: #3E2027;
    margin: 0;
    transition: opacity 0.2s ease;
  }

  .blog-card__link:hover .blog-card__title {
    opacity: 0.8;
  }

  .blog-card__excerpt {
    font-family: var(--font-jokker);
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    color: #3E2027;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    max-height: 63px;
  }

  @media (max-width: 1300px) {
    .blog__wrapper {
      padding: 0 40px;
    }
  }

  /* Responsive - Tablet Landscape */
  @media (max-width: 1200px) {
    .blog__heading {
      font-size: 42px;
      margin-bottom: 50px;
    }

    .blog__seo-heading {
      font-size: 34px;
      max-width: 450px;
    }
  }

  /* Responsive - Tablet */
  @media (max-width: 1024px) {
    .blog {
      padding: 50px 0 60px;
      padding-top: calc(var(--total-header-height, 110px) + 50px);
    }

    .blog__wrapper {
      padding: 0 24px;
    }

    .blog__grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .blog__seo-inner {
      grid-template-columns: 1fr;
      gap: 24px;
    }

    .blog__seo-heading {
      font-size: 32px;
      max-width: 500px;
    }

    .blog__seo-text {
      font-size: 16px;
      line-height: 1.6;
    }

    .blog-card__link {
      gap: 24px;
    }

    .blog-card__title {
      font-size: 18px;
      letter-spacing: -0.18px;
    }

    .blog-card__excerpt {
      font-size: 13px;
    }
  }

  /* Responsive - Mobile */
  @media (max-width: 768px) {
    .blog {
      padding: 40px 0 50px;
      padding-top: calc(var(--total-header-height, 110px) + 40px);
    }

    .blog__wrapper {
      padding: 0 12px;
    }

    .blog__heading {
      font-size: 36px;
      margin-bottom: 40px;
    }

    .blog__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .blog__pagination {
      margin-top: 40px;
    }

    .blog__seo {
      margin-top: 50px;
      padding-top: 40px;
    }

    .blog__seo-heading {
      font-size: 28px;
      max-width: none;
    }

    .blog__seo-text {
      font-size: 15px;
    }

    .blog-card__link {
      gap: 20px;
    }

    .blog-card__title {
      font-size: 16px;
      letter-spacing: -0.16px;
    }

    .blog-card__excerpt {
      font-size: 13px;
      -webkit-line-clamp: 2;
      max-height: 42px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:sections.blog.name",
  "class": "blog-section",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.blog.settings.seo_header"
    },
    {
      "type": "text",
      "id": "seo_heading",
      "label": "t:sections.blog.settings.seo_heading",
      "info": "t:sections.blog.settings.seo_heading_info"
    },
    {
      "type": "richtext",
      "id": "seo_text",
      "label": "t:sections.blog.settings.seo_text",
      "info": "t:sections.blog.settings.seo_text_info"
    }
  ]
}
{% endschema %}
