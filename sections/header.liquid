{% comment %}
  Header section with announcement bar and main navigation
{% endcomment %}

<div
  class="header-wrapper full-width"
  data-sticky-behavior="{{ section.settings.sticky_behavior }}"
  style="
    --header-bg: {{ section.settings.header_bg_color }};
    --header-text: {{ section.settings.header_text_color }};
    --announcement-bg: {{ section.settings.announcement_bg_color }};
    --announcement-text: {{ section.settings.announcement_text_color }};
  ">
  {% comment %} Announcement Bar {% endcomment %}
  {% if section.blocks.size > 0 %}
    <div
      class="announcement-bar"
      role="region"
      aria-label="Announcements">
      <div class="announcement-bar__viewport">
        <div class="announcement-bar__track" data-announcement-marquee>
          <div class="announcement-bar__group">
            {% for block in section.blocks %}
              {% if block.type == 'announcement' %}
                <div class="announcement-bar__item" {{ block.shopify_attributes }}>
                  <span class="announcement-bar__text">{{ block.settings.text }}</span>
                  <span class="announcement-bar__separator">âœ¦</span>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {% comment %} Main Header {% endcomment %}
  <header class="header">
    <div class="header__inner">
      {% comment %} Logo {% endcomment %}
      <div class="header__logo">
        {% if section.settings.logo %}
          <a href="{{ routes.root_url }}">
            {{ section.settings.logo | image_url: width: 200 | image_tag: alt: shop.name, class: 'header__logo-image' }}
          </a>
        {% else %}
          <a href="{{ routes.root_url }}" class="header__logo-text">
            {{ shop.name }}
          </a>
        {% endif %}
      </div>

      {% comment %} Navigation Menu {% endcomment %}
      <nav class="header__menu">
        {% for link in section.settings.menu.links %}
          <a href="{{ link.url }}" class="header__menu-link">
            {{ link.title }}
          </a>
        {% endfor %}
      </nav>

      {% comment %} Icons {% endcomment %}
      <div class="header__icons">
        {% if shop.customer_accounts_enabled %}
          <a
            href="{{ routes.account_url }}"
            class="header__icon"
            aria-label="{{ 'header.account' | t }}">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none">
              <path d="M14 13.1704C12.8505 13.1704 11.8659 12.7744 11.0462 11.9825C10.2266 11.1906 9.81726 10.2398 9.81819 9.13C9.81912 8.02024 10.2285 7.0685 11.0462 6.27479C11.864 5.48107 12.8486 5.08646 14 5.09095C15.1514 5.09544 16.136 5.4905 16.9538 6.27613C17.7715 7.06176 18.1809 8.0135 18.1818 9.13134C18.1828 10.2492 17.7734 11.2 16.9538 11.9839C16.1341 12.7677 15.1495 13.1623 14 13.1704ZM4.24243 21.5111V20.6923C4.24243 20.1365 4.4097 19.6166 4.74425 19.1327C5.07972 18.6478 5.53043 18.2716 6.09637 18.0041C7.41225 17.3944 8.72906 16.9374 10.0468 16.633C11.3636 16.3277 12.6813 16.1751 14 16.1751C15.3187 16.1751 16.6369 16.3277 17.9546 16.633C19.2724 16.9383 20.5882 17.3953 21.9023 18.0041C22.4691 18.2716 22.9198 18.6478 23.2544 19.1327C23.5898 19.6166 23.7576 20.1365 23.7576 20.6923V21.5111C23.7576 21.9062 23.6187 22.2384 23.3408 22.5077C23.0629 22.7753 22.7191 22.9091 22.3093 22.9091H5.69213C5.28231 22.9091 4.93847 22.7749 4.66061 22.5064C4.38276 22.2379 4.24336 21.9071 4.24243 21.5111ZM5.63637 21.5623H22.3636V20.6909C22.3636 20.3928 22.2637 20.1122 22.0639 19.8492C21.8651 19.587 21.5895 19.3652 21.2373 19.1839C20.0906 18.6469 18.9076 18.2357 17.6884 17.9502C16.4691 17.6647 15.2397 17.5219 14 17.5219C12.7603 17.5219 11.5309 17.6647 10.3116 17.9502C9.09241 18.2357 7.90942 18.6469 6.76267 19.1839C6.40954 19.3652 6.13401 19.587 5.93607 19.8492C5.73627 20.1122 5.63637 20.3933 5.63637 20.6923V21.5623ZM14 11.8236C14.7667 11.8236 15.4232 11.5596 15.9696 11.0317C16.5161 10.5037 16.7888 9.86939 16.7879 9.12865C16.787 8.38791 16.5142 7.75402 15.9696 7.22697C15.4251 6.69993 14.7685 6.43595 14 6.43505C13.2315 6.43416 12.5754 6.69813 12.0318 7.22697C11.4881 7.75582 11.2149 8.38971 11.2121 9.12865C11.2093 9.86759 11.4826 10.5019 12.0318 11.0317C12.581 11.5614 13.2371 11.8249 14 11.8222" fill="#3E2027" />
            </svg>
          </a>
        {% endif %}

        <a
          href="{{ routes.cart_url }}"
          class="header__icon header__icon--cart"
          aria-label="{{ 'header.cart' | t }}">
          {% if cart.item_count > 0 %}
            <span class="header__cart-count">{{ cart.item_count }}</span>
          {% endif %}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="28"
            height="28"
            viewBox="0 0 28 28"
            fill="none">
            <path
              d="M4.66699 10.5H23.3337L22.3595 21.2112C22.3068 21.7909 22.0393 22.33 21.6096 22.7226C21.1798 23.1153 20.6188 23.3331 20.0367 23.3333H7.96399C7.38187 23.3331 6.82086 23.1153 6.39109 22.7226C5.96132 22.33 5.69384 21.7909 5.64116 21.2112L4.66699 10.5Z"
              stroke="#3E2027"
              stroke-width="1.375"
              stroke-linejoin="round" />
            <path
              d="M9.33398 12.8333V9.33332C9.33398 8.09565 9.82565 6.90866 10.7008 6.03349C11.576 5.15832 12.763 4.66666 14.0007 4.66666C15.2383 4.66666 16.4253 5.15832 17.3005 6.03349C18.1757 6.90866 18.6673 8.09565 18.6673 9.33332V12.8333"
              stroke="#3E2027"
              stroke-width="1.375"
              stroke-linecap="round" />
          </svg>
        </a>

        <button
          type="button"
          class="header__icon header__menu-toggle"
          aria-label="{{ 'header.menu' | t }}"
          id="mobile-menu-toggle">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="28"
            height="28"
            viewBox="0 0 28 28"
            fill="none">
            <path
              d="M4 7H24M4 14H24M4 21H24"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  {% comment %} Mobile Menu Drawer {% endcomment %}
  <div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu__overlay" id="mobile-menu-overlay"></div>
    <div class="mobile-menu__drawer">
      <div class="mobile-menu__header">
        {% comment %} <span class="mobile-menu__title">{{ 'header.menu' | t }}</span> {% endcomment %}
        <button
          type="button"
          class="mobile-menu__close"
          aria-label="{{ 'header.close_menu' | t }}"
          id="mobile-menu-close">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M18 6L6 18M6 6L18 18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round" />
          </svg>
        </button>
      </div>
      <nav class="mobile-menu__nav">
        {% for link in section.settings.menu.links %}
          <a href="{{ link.url }}" class="mobile-menu__link">
            {{ link.title }}
          </a>
        {% endfor %}
      </nav>
    </div>
  </div>
</div>

{% stylesheet %}
  .header-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    transition: transform 0.3s ease-in-out;
  }

  .header-wrapper.header--hidden {
    transform: translateY(-100%);
  }

  /* Announcement Bar */
  .announcement-bar {
    background-color: var(--announcement-bg);
    color: var(--announcement-text);
    font-family: 'Jokker'
    , Georgia
    , serif;
    font-size: 12px;
    line-height: 1.3;
    height: 40px;
    position: relative;
  }

  .announcement-bar__viewport {
    height: 100%;
    overflow: hidden;
  }

  .announcement-bar__track {
    display: flex;
    align-items: center;
    height: 100%;
    width: max-content;
    white-space: nowrap;
    will-change: transform;
    transform: translateX(0);
  }

  .announcement-bar__track.is-ready {
    animation: announcement-marquee var(--marquee-duration, 30s) linear infinite;
  }

  .announcement-bar__group {
    display: flex;
    align-items: center;
    gap: 50px;
    padding-right: 50px;
  }

  .announcement-bar__item {
    display: flex;
    align-items: center;
    gap: 50px;
  }

  .announcement-bar__text,
  .announcement-bar__separator {
    flex-shrink: 0;
  }

  .announcement-bar__separator {
    font-size: 16px;
  }

  @keyframes announcement-marquee {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(calc(-1 * var(--marquee-distance)));
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .announcement-bar__track.is-ready {
      animation: none;
      transform: translateX(0);
    }
  }

  /* Main Header */
  .header {
    background-color: var(--header-bg);
    height: 70px;
    padding: 0 40px;
  }

  .header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
    margin: 0 auto;
    position: relative;
  }

  /* Logo */
  .header__logo {
    flex-shrink: 0;
    margin-top: 17px;
    height: 35px;
    margin-bottom: 17px;
    width: 103px;
  }

  .header__logo a {
    display: inline-flex;
    align-items: center;
    text-decoration: none;
    transition: opacity 0.2s ease
    , transform 0.2s ease;
  }

  .header__logo a:hover {
    opacity: 0.85;
    transform: translateY(-1px);
  }

  .header__logo a:active {
    opacity: 0.75;
    transform: translateY(0);
  }

  .header__logo a:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 4px;
    border-radius: 6px;
  }

  .header__logo-image {
    max-height: 50px;
    width: auto;
  }

  .header__logo-text {
    font-family: 'Jokker'
    , Georgia
    , serif;
    font-size: 24px;
    color: var(--header-text);
    text-decoration: none;
  }

  /* Menu */
  .header__menu {
    display: flex;
    gap: 30px;
    align-items: center;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
  }

  .header__menu-link {
    font-family: 'Sweet Sans Pro'
    , -apple-system
    , BlinkMacSystemFont
    , 'Segoe UI'
    , sans-serif;
    font-weight: 500;
    font-size: 14px;
    letter-spacing: -0.14px;
    text-transform: uppercase;
    color: var(--header-text);
    text-decoration: none;
    transition: opacity 0.2s ease
    , transform 0.2s ease;
  }

  .header__menu-link:hover {
    opacity: 0.85;
    transform: translateY(-1px);
  }

  .header__menu-link:active {
    opacity: 0.75;
    transform: translateY(0);
  }

  .header__menu-link:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 4px;
    border-radius: 6px;
  }

  /* Icons */
  .header__icons {
    display: flex;
    gap: 14px;
    align-items: center;
  }

  .header__icon {
    color: var(--header-text);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative;
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: opacity 0.2s ease
    , transform 0.2s ease;
  }

  .header__icon:hover {
    opacity: 0.85;
    transform: translateY(-1px);
  }

  .header__icon:active {
    opacity: 0.75;
    transform: translateY(0);
  }

  .header__icon:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 4px;
    border-radius: 6px;
  }

  .header__icon svg {
    width: 28px;
    height: 28px;
  }

  .header__cart-count {
    position: absolute;
    top: -4px;
    right: -8px;
    background-color: var(--header-text);
    color: var(--header-bg);
    font-size: 10px;
    font-weight: 600;
    border-radius: 10px;
    padding: 2px 6px;
    line-height: 1;
    min-width: 18px;
    text-align: center;
  }

  /* Mobile menu toggle - hidden on desktop */
  .header__menu-toggle {
    display: none;
  }

  /* Mobile Menu Drawer */
  .mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 200;
    visibility: hidden;
    pointer-events: none;
  }

  .mobile-menu.is-open {
    visibility: visible;
    pointer-events: auto;
  }

  .mobile-menu__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
  }

  .mobile-menu.is-open .mobile-menu__overlay {
    opacity: 1;
  }

  .mobile-menu__drawer {
    position: absolute;
    top: 0;
    right: 0;
    width: 80%;
    max-width: 400px;
    height: 100%;
    background-color: var(--header-bg);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }

  .mobile-menu.is-open .mobile-menu__drawer {
    transform: translateX(0);
  }

  .mobile-menu__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid rgba(62, 32, 39, 0.1);
  }

  .mobile-menu__title {
    font-family: 'Jokker'
    , Georgia
    , serif;
    font-size: 18px;
    font-weight: 600;
    color: var(--header-text);
  }

  .mobile-menu__close {
    color: var(--header-text);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s ease;
  }

  .mobile-menu__close:hover {
    opacity: 0.7;
  }

  .mobile-menu__nav {
    display: flex;
    flex-direction: column;
    padding: 20px 0;
  }

  .mobile-menu__link {
    font-family: 'Sweet Sans Pro'
    , -apple-system
    , BlinkMacSystemFont
    , 'Segoe UI'
    , sans-serif;
    font-weight: 500;
    font-size: 16px;
    letter-spacing: -0.16px;
    text-transform: uppercase;
    color: var(--header-text);
    text-decoration: none;
    padding: 16px 20px;
    transition: background-color 0.2s ease;
  }

  .mobile-menu__link:hover {
    background-color: rgba(62, 32, 39, 0.05);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .announcement-bar {
      height: 35px;
      font-size: 11px;
    }

    .header {
      height: 60px;
      padding: 0 16px;
    }

    .header__inner {
      padding: 0;
    }

    .header__logo {
      margin-right: auto;
      margin-top: 13.5px;
      margin-bottom: 13.5px;
      height: 33px;
      width: auto;
    }

    .header__logo-image {
      max-height: 33px;
    }

    .header__menu {
      display: none;
    }

    .header__menu-toggle {
      display: flex;
    }
  }
{% endstylesheet %}

{% javascript %}
  class HeaderScrollBehavior {
    constructor() {
      this.header = document.querySelector('.header-wrapper');
      if (!this.header) {
        console.log('Header not found');
        return;
      }

      this.lastScrollY = window.scrollY;
      this.ticking = false;
      this.scrollThreshold = 10;

      const stickyBehavior = this.header.getAttribute('data-sticky-behavior');
      console.log('Sticky behavior setting:', stickyBehavior);

      if (stickyBehavior === 'hide_on_scroll') {
        this.init();
        console.log('Header scroll behavior initialized');
      } else {
        console.log('Header set to always visible');
      }
    }

    init() {
      window.addEventListener('scroll', () => {
        if (!this.ticking) {
          window.requestAnimationFrame(() => {
            this.handleScroll();
            this.ticking = false;
          });
          this.ticking = true;
        }
      });
    }

    handleScroll() {
      const currentScrollY = window.scrollY;

      if (currentScrollY <= 0) {
        this.header.classList.remove('header--hidden');
        this.lastScrollY = currentScrollY;
        return;
      }

      if (Math.abs(currentScrollY - this.lastScrollY) < this.scrollThreshold) {
        return;
      }

      if (currentScrollY > this.lastScrollY) {
        this.header.classList.add('header--hidden');
      } else {
        this.header.classList.remove('header--hidden');
      }

      this.lastScrollY = currentScrollY;
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      new HeaderScrollBehavior();
    });
  } else {
    new HeaderScrollBehavior();
  }

/* Mobile Menu Toggle */
  (function() {
    const menu = document.getElementById('mobile-menu');
    const toggleButton = document.getElementById('mobile-menu-toggle');
    const closeButton = document.getElementById('mobile-menu-close');
    const overlay = document.getElementById('mobile-menu-overlay');

    if (! menu || ! toggleButton) {
      console.log('Mobile menu elements not found');
      return;
    }

    function openMenu() {
      console.log('Opening mobile menu');
      menu.classList.add('is-open');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      console.log('Closing mobile menu');
      menu.classList.remove('is-open');
      document.body.style.overflow = '';
    }

    toggleButton.addEventListener('click', function(e) {
      e.preventDefault();
      console.log('Toggle button clicked');
      openMenu();
    });

    if (closeButton) {
      closeButton.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Close button clicked');
        closeMenu();
      });
    }

    if (overlay) {
      overlay.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Overlay clicked');
        closeMenu();
      });
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && menu.classList.contains('is-open')) {
        console.log('Escape key pressed');
        closeMenu();
      }
    });

    console.log('Mobile menu initialized');
  })();

/* Announcement marquee */
  (function() {
    let resizeTimer;

    function buildMarquee() {
      const bar = document.querySelector('.announcement-bar');
      if (! bar) return;
      


      const viewport = bar.querySelector('.announcement-bar__viewport');
      const track = bar.querySelector('[data-announcement-marquee]');
      const group = track && track.querySelector('.announcement-bar__group');
      if (! viewport || ! track || ! group) return;
      


      track.querySelectorAll('.announcement-bar__group[aria-hidden="true"]').forEach((n) => n.remove());
      track.classList.remove('is-ready');

      const groupWidth = group.scrollWidth;
      const viewportWidth = viewport.clientWidth;
      if (! groupWidth || ! viewportWidth) return;
      


      let totalWidth = groupWidth;
      const targetWidth = viewportWidth * 3;

      while (totalWidth < targetWidth) {
        const clone = group.cloneNode(true);
        clone.setAttribute('aria-hidden', 'true');
        track.appendChild(clone);
        totalWidth += groupWidth;
      }

      track.style.setProperty('--marquee-distance', `${groupWidth}px`);

      const speed = 70;
      const duration = Math.max(12, groupWidth / speed);
      track.style.setProperty('--marquee-duration', `${duration}s`);

      track.classList.add('is-ready');
    }

    function init() {
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => requestAnimationFrame(buildMarquee));
      } else {
        requestAnimationFrame(buildMarquee);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(buildMarquee, 150);
    });
  })();
{% endjavascript %}

{% schema %}
  {
    "name": "t:general.header",
    "class": "header-section",
    "settings": [
      {
        "type": "header",
        "content": "t:header.settings.behavior_header"
      },
      {
        "type": "select",
        "id": "sticky_behavior",
        "label": "t:header.settings.sticky_behavior",
        "options": [
          {
            "value": "always_visible",
            "label": "t:header.settings.sticky_behavior_options.always_visible"
          }, {
            "value": "hide_on_scroll",
            "label": "t:header.settings.sticky_behavior_options.hide_on_scroll"
          }
        ],
        "default": "hide_on_scroll",
        "info": "t:header.settings.sticky_behavior_info"
      },
      {
        "type": "header",
        "content": "t:header.settings.logo_header"
      },
      {
        "type": "image_picker",
        "id": "logo",
        "label": "t:header.settings.logo"
      }, {
        "type": "header",
        "content": "t:header.settings.menu_header"
      }, {
        "type": "link_list",
        "id": "menu",
        "label": "t:header.settings.menu",
        "default": "main-menu"
      }, {
        "type": "header",
        "content": "t:header.settings.colors_header"
      }, {
        "type": "color",
        "id": "header_bg_color",
        "label": "t:header.settings.header_bg_color",
        "default": "#FFF7EA"
      }, {
        "type": "color",
        "id": "header_text_color",
        "label": "t:header.settings.header_text_color",
        "default": "#3E2027"
      }, {
        "type": "color",
        "id": "announcement_bg_color",
        "label": "t:header.settings.announcement_bg_color",
        "default": "#3E2027"
      }, {
        "type": "color",
        "id": "announcement_text_color",
        "label": "t:header.settings.announcement_text_color",
        "default": "#FFFAE6"
      }
    ],
    "blocks": [
      {
        "type": "announcement",
        "name": "t:header.blocks.announcement.name",
        "limit": 5,
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "t:header.blocks.announcement.settings.text",
            "default": "Announcement text"
          }
        ]
      }
    ],
    "max_blocks": 5
  }
{% endschema %}