{% comment %}
  Meet Your Scents section - Interactive video with hoverable tooltip markers
{% endcomment %}

<div class="meet-scents full-width">
  <div class="meet-scents__container">
    {% comment %} Heading {% endcomment %}
    {% if section.settings.heading != blank %}
      <h2 class="meet-scents__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    {% comment %} Video Container {% endcomment %}
    <div class="meet-scents__video-wrapper">
      {% if section.settings.video %}
        <div class="meet-scents__video">
          {{ section.settings.video | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true, class: 'meet-scents__video-element'
          }}
        </div>
      {% elsif section.settings.placeholder_image %}
        <div class="meet-scents__video">
          {{ section.settings.placeholder_image | image_url: width: 1360 | image_tag: class: 'meet-scents__video-element' }}
        </div>
      {% endif %}

      {% comment %} Tooltip Circles - Positioned using CSS Grid {% endcomment %}
      {% if section.blocks.size > 0 %}
        <div class="meet-scents__markers">
          {% for block in section.blocks %}
            {% if block.type == 'tooltip_marker' %}
              <div
                class="meet-scents__marker"
                style="
                  --marker-x: {{ block.settings.position_x }}%;
                  --marker-y: {{ block.settings.position_y }}%;
                "
                {{ block.shopify_attributes }}>

                {% comment %} Circle SVG {% endcomment %}
                <div class="meet-scents__marker-circle">
                  <svg
                    width="36"
                    height="36"
                    viewBox="0 0 36 36"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <g filter="url(#filter0_d_{{ block.id }})">
                      <circle
                        cx="18"
                        cy="18"
                        r="13"
                        fill="white" />
                    </g>
                    <defs>
                      <filter
                        id="filter0_d_{{ block.id }}"
                        x="0"
                        y="0"
                        width="36"
                        height="36"
                        filterUnits="userSpaceOnUse"
                        color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feColorMatrix
                          in="SourceAlpha"
                          type="matrix"
                          values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                          result="hardAlpha" />
                        <feOffset/>
                        <feGaussianBlur stdDeviation="2.5" />
                        <feComposite in2="hardAlpha" operator="out" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                        <feBlend
                          mode="normal"
                          in2="BackgroundImageFix"
                          result="effect1_dropShadow_{{ block.id }}" />
                        <feBlend
                          mode="normal"
                          in="SourceGraphic"
                          in2="effect1_dropShadow_{{ block.id }}"
                          result="shape" />
                      </filter>
                    </defs>
                  </svg>
                </div>

                {% comment %} Tooltip (Placeholder for now) {% endcomment %}
                {% if block.settings.tooltip_title != blank or block.settings.tooltip_text != blank %}
                  <div class="meet-scents__tooltip">
                    {% if block.settings.tooltip_title != blank %}
                      <h3 class="meet-scents__tooltip-title">{{ block.settings.tooltip_title }}</h3>
                    {% endif %}
                    {% if block.settings.tooltip_text != blank %}
                      <p class="meet-scents__tooltip-text">{{ block.settings.tooltip_text }}</p>
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% stylesheet %}
  .meet-scents {
    background-color: #FFF7EA;
    padding: 30px 0 60px;
    overflow: hidden;
  }

  .meet-scents__container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 49px;
  }

  /* Heading */
  .meet-scents__heading {
    font-family: var(--font-alyona);
    font-size: 70px;
    font-weight: 400;
    line-height: 1;
    color: #FFFFFF;
    margin: 0;
    text-align: center;
    width: 100%;
  }

  /* Video Wrapper - Using Grid for positioning */
  .meet-scents__video-wrapper {
    position: relative;
    width: 100%;
    /* max-width: 1400px; */
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }

  /* Video Container */
  .meet-scents__video {
    grid-column: 1;
    grid-row: 1;
    width: 100%;
    height: auto;
    aspect-ratio: 1360 / 765;
    overflow: hidden;
    clip-path: url('#meet-scents-mask');
  }

  .meet-scents__video-element {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Markers Container - Uses Grid, overlays video */
  .meet-scents__markers {
    grid-column: 1;
    grid-row: 1;
    position: relative;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  /* Individual Marker - Positioned using CSS custom properties */
  .meet-scents__marker {
    position: absolute;
    left: var(--marker-x);
    top: var(--marker-y);
    transform: translate(-50%, -50%);
    pointer-events: auto;
    z-index: 2;
  }

  /* Marker Circle */
  .meet-scents__marker-circle {
    width: 36px;
    height: 36px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .meet-scents__marker:hover .meet-scents__marker-circle {
    transform: scale(1.1);
  }

  .meet-scents__marker-circle svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  /* Tooltip - Placeholder styling */
  .meet-scents__tooltip {
    position: absolute;
    bottom: calc(100% + 12px);
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 16px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 200px;
    max-width: 280px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease
    , visibility 0.3s ease;
    pointer-events: none;
    z-index: 10;
  }

  .meet-scents__marker:hover .meet-scents__tooltip {
    opacity: 1;
    visibility: visible;
  }

  /* Tooltip arrow */
  .meet-scents__tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid white;
  }

  .meet-scents__tooltip-title {
    font-family: var(--font-sweet-sans);
    font-weight: 600;
    font-size: 16px;
    line-height: 1.3;
    color: #3E2027;
    margin: 0 0 8px;
  }

  .meet-scents__tooltip-text {
    font-family: var(--font-jokker);
    font-size: 14px;
    line-height: 1.4;
    color: #3E2027;
    margin: 0;
  }

  /* SVG Clip Path Definition */
  .meet-scents__video::before {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .meet-scents__container {
      padding: 0 24px;
    }

    .meet-scents__heading {
      font-size: 56px;
    }
  }

  @media (max-width: 768px) {
    .meet-scents {
      padding: 20px 0 40px;
    }

    .meet-scents__container {
      padding: 0 16px;
      gap: 30px;
    }

    .meet-scents__heading {
      font-size: 40px;
    }

    .meet-scents__marker-circle {
      width: 28px;
      height: 28px;
    }

    .meet-scents__tooltip {
      min-width: 180px;
      max-width: 240px;
      padding: 12px 16px;
      font-size: 13px;
    }

    .meet-scents__tooltip-title {
      font-size: 14px;
    }

    .meet-scents__tooltip-text {
      font-size: 12px;
    }
  }
{% endstylesheet %}

{% javascript %}
  // Video autoplay fallback
  document.addEventListener('DOMContentLoaded', function() {
    const video = document.querySelector('.meet-scents__video-element');
    if (video && video.tagName === 'VIDEO') { // Ensure video plays on mobile
      video.play().catch(function(error) {
        console.log('Video autoplay prevented:', error);
      });
    }
  });
{% endjavascript %}

{% schema %}
  {
    "name": "t:general.meet_your_scents",
    "class": "meet-scents-section",
    "settings": [
      {
        "type": "header",
        "content": "t:sections.meet_scents.content_header"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "t:labels.heading",
        "default": "Meet Your Scents"
      },
      {
        "type": "header",
        "content": "t:sections.meet_scents.video_header"
      },
      {
        "type": "video",
        "id": "video",
        "label": "t:labels.video"
      }, {
        "type": "image_picker",
        "id": "placeholder_image",
        "label": "t:labels.placeholder_image",
        "info": "t:sections.meet_scents.placeholder_info"
      }
    ],
    "blocks": [
      {
        "type": "tooltip_marker",
        "name": "t:blocks.tooltip_marker.name",
        "settings": [
          {
            "type": "header",
            "content": "t:blocks.tooltip_marker.position_header"
          },
          {
            "type": "range",
            "id": "position_x",
            "label": "t:labels.horizontal_position",
            "info": "t:blocks.tooltip_marker.position_x_info",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "default": 50
          },
          {
            "type": "range",
            "id": "position_y",
            "label": "t:labels.vertical_position",
            "info": "t:blocks.tooltip_marker.position_y_info",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "default": 50
          },
          {
            "type": "header",
            "content": "t:blocks.tooltip_marker.tooltip_header"
          }, {
            "type": "text",
            "id": "tooltip_title",
            "label": "t:labels.tooltip_title",
            "default": "Scent Name"
          }, {
            "type": "textarea",
            "id": "tooltip_text",
            "label": "t:labels.tooltip_description",
            "default": "Brief description of this scent."
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "t:general.meet_your_scents",
        "blocks": [
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 15,
              "position_y": 66,
              "tooltip_title": "Capri Seaside",
              "tooltip_text": "Fresh citrus and ocean notes"
            }
          },
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 29,
              "position_y": 61,
              "tooltip_title": "Petal Kiss",
              "tooltip_text": "Soft floral bouquet"
            }
          },
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 49,
              "position_y": 66,
              "tooltip_title": "Deep Ritual",
              "tooltip_text": "Warm woody undertones"
            }
          },
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 59,
              "position_y": 37,
              "tooltip_title": "Sweet Touch",
              "tooltip_text": "Gentle vanilla and amber"
            }
          }, {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 65,
              "position_y": 60,
              "tooltip_title": "It Proper",
              "tooltip_text": "Bold and sophisticated"
            }
          }, {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 79,
              "position_y": 64,
              "tooltip_title": "Barely There",
              "tooltip_text": "Subtle and clean"
            }
          }
        ]
      }
    ]
  }
{% endschema %}