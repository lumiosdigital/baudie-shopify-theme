{% comment %}
  Meet Your Scents section - Interactive video with hoverable tooltip markers
{% endcomment %}

<div class="meet-scents full-width">
  <div class="meet-scents__container">
    {% comment %} Video Container {% endcomment %}
    <div class="meet-scents__video-wrapper">
      {% comment %} Heading - Overlaid on video {% endcomment %}
      {% if section.settings.heading != blank %}
        <h2 class="meet-scents__heading">{{ section.settings.heading }}</h2>
      {% endif %}

      {% if section.settings.video %}
        <div class="meet-scents__video">
          {{ section.settings.video | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true, class: 'meet-scents__video-element'
          }}
        </div>
      {% elsif section.settings.placeholder_image %}
        <div class="meet-scents__video">
          {{ section.settings.placeholder_image | image_url: width: 1360 | image_tag: class: 'meet-scents__video-element' }}
        </div>
      {% endif %}

      {% comment %} Tooltip Circles - Positioned using CSS Grid {% endcomment %}
      {% if section.blocks.size > 0 %}
        <div class="meet-scents__markers">
          {% for block in section.blocks %}
            {% if block.type == 'tooltip_marker' %}
              <div
                class="meet-scents__marker"
                style="
                  --marker-x: {{ block.settings.position_x }}%;
                  --marker-y: {{ block.settings.position_y }}%;
                "
                {{ block.shopify_attributes }}>

                {% comment %} Circle SVG {% endcomment %}
                <div class="meet-scents__marker-circle">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="36"
                    height="36"
                    viewBox="0 0 36 36"
                    fill="none">
                    <circle
                      opacity="0.3"
                      cx="18"
                      cy="18"
                      r="18"
                      fill="white" />
                    <circle
                      cx="18"
                      cy="18"
                      r="10"
                      fill="white" />
                  </svg>
                </div>

                {% comment %} Tooltip {% endcomment %}
                {% if block.settings.product != blank %}
                  {% assign tooltip_product = block.settings.product %}
                    <div class="meet-scents__tooltip">
                    {% comment %} Stars and Review Count {% endcomment %}
                    <div class="meet-scents__tooltip-rating">
                      <div class="meet-scents__tooltip-stars">
                        {% if tooltip_product.metafields.reviews.rating.value %}
                          {% assign rating = tooltip_product.metafields.reviews.rating.value.rating %}
                          {% assign review_count = tooltip_product.metafields.reviews.rating.value.count | default: 0 %}
                        {% else %}
                          {% assign rating = 5 %}
                          {% assign review_count = 0 %}
                        {% endif %}

                        {% for i in (1..5) %}
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="14"
                            height="14"
                            viewBox="0 0 14 14"
                            fill="none">
                            <path d="M6.66818 0.216469C6.69884 0.151475 6.74623 0.0967878 6.80496 0.0585181C6.86369 0.0202485 6.93148 0 7.00063 0C7.06977 0 7.13756 0.0202485 7.19629 0.0585181C7.25502 0.0967878 7.30241 0.151475 7.33307 0.216469L8.9499 3.6511C9.04568 3.8772 9.19368 4.07277 9.38215 4.22109C9.57062 4.3694 9.79246 4.46601 10.0263 4.50664L13.6822 5.05758C13.7507 5.06798 13.8151 5.09829 13.868 5.14507C13.921 5.19185 13.9604 5.25325 13.9818 5.32228C14.0032 5.39133 14.0059 5.46528 13.9891 5.53577C13.9724 5.60625 13.9369 5.67049 13.888 5.72117L11.2731 8.39167C11.1206 8.56791 11.0116 8.78548 10.957 9.02163C10.9025 9.25778 10.9048 9.50531 10.9638 9.74024L11.5627 13.543C11.5747 13.6151 11.5674 13.6891 11.5415 13.7567C11.5155 13.8242 11.4718 13.8827 11.4154 13.9258C11.3591 13.9688 11.2925 13.994 11.2231 13.999C11.1537 14.004 11.0844 13.9886 11.0231 13.9543L7.69076 12.1621C7.47779 12.0348 7.24083 11.9695 7.00028 11.9695C6.75973 11.9695 6.52276 12.0348 6.30979 12.1621L2.97818 13.9543C2.91682 13.9884 2.84757 14.0038 2.77832 13.9987C2.70906 13.9935 2.64242 13.9681 2.58642 13.925C2.53041 13.8819 2.48671 13.8228 2.46084 13.7553C2.43497 13.6878 2.42783 13.6142 2.43984 13.543L3.03588 9.7417C3.09461 9.50619 3.09696 9.25821 3.04248 9.02193C2.98799 8.78564 2.87883 8.56795 2.72621 8.39167L0.111319 5.72245C0.0632499 5.67186 0.0278529 5.60694 0.00903011 5.53625C-0.00979272 5.46553 -0.0133341 5.39134 0.00806134 5.32198C0.0294568 5.25266 0.0689896 5.19106 0.122242 5.14419C0.175494 5.09732 0.240229 5.06691 0.309031 5.05684L3.96421 4.50664C4.19836 4.4663 4.42046 4.36981 4.60925 4.22148C4.79805 4.07315 4.9464 3.87741 5.04399 3.6511L6.66818 0.216469Z" fill="#3E2027" />
                          </svg>
                        {% endfor %}
                      </div>
                      {% if review_count > 0 %}
                        <span class="meet-scents__tooltip-review-count">({{ review_count }})</span>
                      {% endif %}
                    </div>

                    {% comment %} Product Name and Price {% endcomment %}
                    <div class="meet-scents__tooltip-header">
                      <h3 class="meet-scents__tooltip-title">{{ tooltip_product.title }}</h3>
                      <p class="meet-scents__tooltip-price">{{ tooltip_product.price | money }}</p>
                    </div>

                    {% comment %} Description {% endcomment %}
                    {% if block.settings.tooltip_description != blank %}
                      <p class="meet-scents__tooltip-description">{{ block.settings.tooltip_description }}</p>
                    {% elsif tooltip_product.metafields.custom.short_description %}
                      <p class="meet-scents__tooltip-description">{{ tooltip_product.metafields.custom.short_description }}</p>
                    {% endif %}

                    {% comment %} Action Buttons {% endcomment %}
                    <div class="meet-scents__tooltip-actions">
                      {% form 'product'
                        , tooltip_product %}
                        <input
                          type="hidden"
                          name="id"
                          value="{{ tooltip_product.selected_or_first_available_variant.id }}">
                        <button
                          type="submit"
                          name="add"
                          class="meet-scents__tooltip-btn meet-scents__tooltip-btn--add"
                          {% unless tooltip_product.available %}
                          disabled{% endunless %}>
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            viewBox="0 0 16 16"
                            fill="none">
                            <path
                              d="M0.75 7.75H14.75M7.75 0.75V14.75"
                              stroke="#3E2027"
                              stroke-width="1.5"
                              stroke-linecap="round"
                              stroke-linejoin="round" />
                          </svg>
                          <span>{{ 'products.add_to_cart' | t }}</span>
                        </button>
                      {% endform %}
                      <a href="{{ tooltip_product.url }}" class="meet-scents__tooltip-btn meet-scents__tooltip-btn--buy">
                        {{ 'products.buy_now' | t }}
                      </a>
                    </div>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% stylesheet %}
  .meet-scents {
    background-color: #FFF7EA;
    padding: 30px 0 60px;
    overflow: hidden;
  }

  .meet-scents__container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Heading - Overlaid on video top left */
  .meet-scents__heading {
    grid-column: 1;
    grid-row: 1;
    font-family: var(--font-alyona);
    font-size: 70px;
    font-weight: 400;
    line-height: 1;
    color: #FFFFFF;
    margin: 0;
    padding: 49px 0 0 40px;
    align-self: start;
    justify-self: start;
    z-index: 3;
    pointer-events: none;
  }

  /* Video Wrapper - Using Grid for positioning */
  .meet-scents__video-wrapper {
    position: relative;
    width: 100%;
    /* max-width: 1360px; */
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }

  /* Video Container */
  .meet-scents__video {
    grid-column: 1;
    grid-row: 1;
    width: 100%;
    height: auto;
    aspect-ratio: 1360 / 765;
    overflow: hidden;
    clip-path: url('#meet-scents-mask');
  }

  .meet-scents__video-element {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Markers Container - Uses Grid, overlays video */
  .meet-scents__markers {
    grid-column: 1;
    grid-row: 1;
    position: relative;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  /* Individual Marker - Positioned using CSS custom properties */
  .meet-scents__marker {
    position: absolute;
    left: var(--marker-x);
    top: var(--marker-y);
    transform: translate(-50%, -50%);
    pointer-events: auto;
    z-index: 2;
  }

  /* Marker Circle */
  .meet-scents__marker-circle {
    width: 36px;
    height: 36px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .meet-scents__marker:hover .meet-scents__marker-circle {
    transform: scale(1.1);
  }

  .meet-scents__marker-circle svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  /* Tooltip - Matches Figma Design */
  .meet-scents__tooltip {
    position: absolute;
    bottom: calc(100% + 12px);
    left: 50%;
    transform: translateX(-50%);
    background: #FFFFFF;
    padding: 15px;
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease
    , visibility 0.3s ease;
    pointer-events: none;
    z-index: 10;
  }

  .meet-scents__marker:hover .meet-scents__tooltip {
    opacity: 1;
    visibility: visible;
  }

  /* Tooltip arrow - centered below tooltip */
  .meet-scents__tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 12.5px solid transparent;
    border-right: 12.5px solid transparent;
    border-top: 14.5px solid #FFFFFF;
  }

  /* Rating Stars */
  .meet-scents__tooltip-rating {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .meet-scents__tooltip-stars {
    display: flex;
    gap: 4px;
  }

  .meet-scents__tooltip-stars svg {
    width: 14px;
    height: 14px;
  }

  .meet-scents__tooltip-review-count {
    font-family: var(--font-jokker);
    font-size: 14px;
    line-height: 1.5;
    color: #3E2027;
  }

  /* Header - Title and Price */
  .meet-scents__tooltip-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }

  .meet-scents__tooltip-title {
    font-family: var(--font-sweet-sans);
    font-weight: 500;
    font-size: 18px;
    line-height: normal;
    letter-spacing: -0.18px;
    text-transform: uppercase;
    color: #3E2027;
    margin: 0;
  }

  .meet-scents__tooltip-price {
    font-family: var(--font-sweet-sans);
    font-weight: 400;
    font-size: 18px;
    line-height: normal;
    letter-spacing: -0.18px;
    text-transform: uppercase;
    color: #3E2027;
    margin: 0;
  }

  /* Description */
  .meet-scents__tooltip-description {
    font-family: var(--font-jokker);
    font-size: 16px;
    line-height: 1.5;
    color: #3E2027;
    margin: 0;
  }

  /* Action Buttons */
  .meet-scents__tooltip-actions {
    display: flex;
    gap: 10px;
    width: 100%;
  }

  .meet-scents__tooltip-actions form {
    flex: 1;
    margin: 0;
  }

  .meet-scents__tooltip-btn {
    height: 40px;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-family: var(--font-sweet-sans);
    font-weight: 500;
    font-size: 14px;
    line-height: normal;
    letter-spacing: -0.14px;
    text-transform: uppercase;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s ease
    , transform 0.2s ease;
    white-space: nowrap;
    width: 100%;
  }

  .meet-scents__tooltip-btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  .meet-scents__tooltip-btn:active {
    opacity: 0.8;
    transform: translateY(0);
  }

  .meet-scents__tooltip-btn--add {
    background: #FFFFFF;
    color: #3E2027;
    border: 1px solid #3E2027;
  }

  .meet-scents__tooltip-btn--add:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .meet-scents__tooltip-btn--add svg {
    width: 16px;
    height: 16px;
  }

  .meet-scents__tooltip-btn--buy {
    background: #3E2027;
    color: #FFFAE6;
    flex: 1;
  }

  /* SVG Clip Path Definition */
  .meet-scents__video::before {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .meet-scents__container {
      padding: 0 24px;
    }

    .meet-scents__heading {
      font-size: 56px;
      padding: 40px 0 0 24px;
    }
  }

  @media (max-width: 768px) {
    .meet-scents {
      padding: 20px 0 40px;
    }

    .meet-scents__container {
      padding: 0 16px;
    }

    .meet-scents__heading {
      font-size: 40px;
      padding: 30px 0 0 16px;
    }

    .meet-scents__marker-circle {
      width: 28px;
      height: 28px;
    }

    .meet-scents__tooltip {
      width: 280px;
      padding: 12px;
      gap: 8px;
    }

    .meet-scents__tooltip-title,
    .meet-scents__tooltip-price {
      font-size: 16px;
    }

    .meet-scents__tooltip-description {
      font-size: 14px;
    }

    .meet-scents__tooltip-btn {
      font-size: 12px;
      height: 36px;
      padding: 8px 16px;
    }
  }
{% endstylesheet %}

{% javascript %}
  // Video autoplay fallback
  document.addEventListener('DOMContentLoaded', function() {
    const video = document.querySelector('.meet-scents__video-element');
    if (video && video.tagName === 'VIDEO') { // Ensure video plays on mobile
      video.play().catch(function(error) {
        console.log('Video autoplay prevented:', error);
      });
    }
  });
{% endjavascript %}

{% schema %}
  {
    "name": "t:general.meet_your_scents",
    "class": "meet-scents-section",
    "settings": [
      {
        "type": "header",
        "content": "t:sections.meet_scents.content_header"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "t:labels.heading",
        "default": "Meet Your Scents"
      },
      {
        "type": "header",
        "content": "t:sections.meet_scents.video_header"
      },
      {
        "type": "video",
        "id": "video",
        "label": "t:labels.video"
      }, {
        "type": "image_picker",
        "id": "placeholder_image",
        "label": "t:labels.placeholder_image",
        "info": "t:sections.meet_scents.placeholder_info"
      }
    ],
    "blocks": [
      {
        "type": "tooltip_marker",
        "name": "t:blocks.tooltip_marker.name",
        "settings": [
          {
            "type": "header",
            "content": "t:blocks.tooltip_marker.position_header"
          },
          {
            "type": "range",
            "id": "position_x",
            "label": "t:labels.horizontal_position",
            "info": "t:blocks.tooltip_marker.position_x_info",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "default": 50
          },
          {
            "type": "range",
            "id": "position_y",
            "label": "t:labels.vertical_position",
            "info": "t:blocks.tooltip_marker.position_y_info",
            "min": 0,
            "max": 100,
            "step": 1,
            "unit": "%",
            "default": 50
          },
          {
            "type": "header",
            "content": "t:blocks.tooltip_marker.tooltip_header"
          }, {
            "type": "product",
            "id": "product",
            "label": "t:labels.product"
          }, {
            "type": "textarea",
            "id": "tooltip_description",
            "label": "t:labels.tooltip_description",
            "info": "t:blocks.tooltip_marker.description_info"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "t:general.meet_your_scents",
        "blocks": [
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 15,
              "position_y": 66,
              "product": "capri-seaside",
              "tooltip_description": "Fresh citrus and ocean notes"
            }
          },
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 29,
              "position_y": 61,
              "product": "petal-kiss",
              "tooltip_description": "Soft floral bouquet"
            }
          },
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 49,
              "position_y": 66,
              "product": "deep-ritual",
              "tooltip_description": "Pepper, sandalwood & cedarwood â€” grounding, clean, and a little mysterious."
            }
          },
          {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 59,
              "position_y": 37,
              "product": "sweet-touch",
              "tooltip_description": "Gentle vanilla and amber"
            }
          }, {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 65,
              "position_y": 60,
              "product": "it-proper",
              "tooltip_description": "Bold and sophisticated"
            }
          }, {
            "type": "tooltip_marker",
            "settings": {
              "position_x": 79,
              "position_y": 64,
              "product": "barely-there",
              "tooltip_description": "Subtle and clean"
            }
          }
        ]
      }
    ]
  }
{% endschema %}