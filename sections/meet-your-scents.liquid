{%- liquid
  assign has_products = false
  if section.blocks.size > 0
    assign has_products = true
  endif
-%}

<meet-scents-section class="meet-scents full-width">
  {%- if section.settings.heading != blank -%}
    <h2 class="meet-scents__mobile-heading">{{ section.settings.heading | escape }}</h2>
  {%- endif -%}
  <div class="meet-scents__container">
    <div class="meet-scents__left">
      <div class="meet-scents__image-wrapper">
        {%- if section.settings.side_image != blank -%}
          {{ section.settings.side_image | image_url: width: 1400 | image_tag:
            class: 'meet-scents__side-image',
            loading: 'lazy',
            alt: section.settings.heading
          }}
        {%- else -%}
          <div class="meet-scents__side-placeholder">
            {{ 'lifestyle-1' | placeholder_svg_tag: 'meet-scents__placeholder-svg' }}
          </div>
        {%- endif -%}
        <div class="meet-scents__overlay"></div>
        {%- if section.settings.heading != blank -%}
          <h2 class="meet-scents__heading">{{ section.settings.heading | escape }}</h2>
        {%- endif -%}
      </div>
    </div>

    <div class="meet-scents__right">
      {%- if section.settings.background_image != blank -%}
        {{ section.settings.background_image | image_url: width: 1400 | image_tag:
          class: 'meet-scents__bg-image',
          loading: 'lazy',
          alt: ''
        }}
      {%- else -%}
        <div class="meet-scents__bg-placeholder"></div>
      {%- endif -%}

      {%- if has_products -%}
        <div class="meet-scents__content">
          <div class="meet-scents__card-wrapper">
            <div class="meet-scents__cards" data-cards>
              {%- for block in section.blocks -%}
                {%- assign product = block.settings.product -%}
                {%- if product != blank -%}
                  {%- assign card_color = product.metafields.custom.card_background_color | default: '#FFCAD2' -%}
                  {%- assign product_image = product.featured_image -%}
                  <a
                    href="{{ product.url }}"
                    id="meet-scents-card-{{ forloop.index0 }}"
                    class="meet-scents__card{% if forloop.first %} is-active{% endif %}"
                    data-card="{{ forloop.index0 }}"
                    data-color="{{ card_color }}"
                    role="tabpanel"
                    aria-labelledby="meet-scents-tab-{{ forloop.index0 }}"
                    {% unless forloop.first %}aria-hidden="true" tabindex="-1"{% endunless %}
                    {{ block.shopify_attributes }}>
                    <div class="meet-scents__card-image">
                      {%- if product_image != blank -%}
                        {{ product_image | image_url: width: 800 | image_tag:
                          class: 'meet-scents__product-image',
                          loading: 'lazy',
                          alt: product.title
                        }}
                      {%- else -%}
                        <div class="meet-scents__product-placeholder">
                          {{ 'product-1' | placeholder_svg_tag: 'meet-scents__product-placeholder-svg' }}
                        </div>
                      {%- endif -%}
                    </div>
                    <div class="meet-scents__card-info">
                      <h3 class="meet-scents__product-title">{{ product.title | escape }}</h3>
                      {%- if product.metafields.custom.short_description != blank -%}
                        <p class="meet-scents__product-description">{{ product.metafields.custom.short_description | escape }}</p>
                      {%- elsif product.description != blank -%}
                        <p class="meet-scents__product-description">{{ product.description | strip_html | truncate: 80 }}</p>
                      {%- endif -%}
                    </div>
                  </a>
                {%- endif -%}
              {%- endfor -%}
            </div>

            <div class="meet-scents__tabs" data-tabs role="tablist" aria-label="{{ 'sections.meet_scents.tabs_label' | t }}">
              {%- for block in section.blocks -%}
                {%- assign product = block.settings.product -%}
                {%- if product != blank -%}
                  {%- assign tab_color = block.settings.tab_color | default: '#FFCAD2' -%}
                  {%- assign tab_text_color = block.settings.tab_text_color | default: '#FFFAE6' -%}
                  {%- assign tab_z_index = forloop.length | minus: forloop.index0 -%}
                  <button
                    type="button"
                    id="meet-scents-tab-{{ forloop.index0 }}"
                    class="meet-scents__tab{% if forloop.first %} is-active{% endif %}"
                    data-tab="{{ forloop.index0 }}"
                    role="tab"
                    aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                    aria-controls="meet-scents-card-{{ forloop.index0 }}"
                    style="--tab-color: {{ tab_color }}; --tab-text-color: {{ tab_text_color }}; --tab-z-index: {{ tab_z_index }};">
                    <span class="meet-scents__tab-text">{{ product.title | escape }}</span>
                  </button>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>

          <div class="meet-scents__dots" data-dots role="group" aria-label="{{ 'sections.meet_scents.pagination_label' | t }}">
            {%- for block in section.blocks -%}
              {%- assign product = block.settings.product -%}
              {%- if product != blank -%}
                <button
                  type="button"
                  class="meet-scents__dot{% if forloop.first %} is-active{% endif %}"
                  data-dot="{{ forloop.index0 }}"
                  aria-label="{{ 'sections.meet_scents.go_to_product' | t: name: product.title }}"
                  aria-current="{% if forloop.first %}true{% else %}false{% endif %}">
                </button>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      {%- endif -%}
    </div>
  </div>
</meet-scents-section>

{% stylesheet %}
  .meet-scents {
    background-color: #FFF7EA;
  }

  .meet-scents__container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    max-width: 1520px;
    margin: 0 auto 80px;
    min-height: 751px;
  }

  .meet-scents__left {
    position: relative;
    overflow: hidden;
  }

  .meet-scents__image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 751px;
  }

  .meet-scents__side-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .meet-scents__side-placeholder {
    position: absolute;
    inset: 0;
    background-color: rgba(62, 32, 39, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .meet-scents__placeholder-svg {
    width: 200px;
    height: 200px;
    opacity: 0.3;
  }

  .meet-scents__overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 189px;
    background: linear-gradient(to top, rgba(62, 32, 39, 0.5) 0%, rgba(62, 32, 39, 0) 95%);
    pointer-events: none;
  }

  .meet-scents__heading {
    position: absolute;
    bottom: 38px;
    left: 40px;
    right: 40px;
    font-family: var(--font-alyona);
    font-size: 70px;
    font-weight: 400;
    line-height: 1;
    color: #FFFFFF;
    margin: 0;
    z-index: 2;
  }

  .meet-scents__right {
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 60px 80px 60px 40px;
  }

  .meet-scents__bg-image {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .meet-scents__bg-placeholder {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #E8F4F8 0%, #D4EBF2 100%);
  }

  .meet-scents__content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 40px;
  }

  .meet-scents__card-wrapper {
    position: relative;
    display: flex;
    align-items: flex-start;
    min-height: 600px;
  }

  .meet-scents__cards {
    position: relative;
    min-height: 580px;
  }

  .meet-scents__card {
    display: none;
    text-decoration: none;
    color: inherit;
    background: #FFFFFF;
    border-radius: 20px 0 20px 20px;
    overflow: hidden;
    width: 365px;
    height: 600px;
    padding: 20px 20px 0;
  }

  .meet-scents__card.is-active {
    display: block;
  }

  .meet-scents__card:focus-visible {
    outline: 2px solid #3E2027;
    outline-offset: 4px;
  }

  .meet-scents__card-image {
    width: 325px;
    height: 420px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: 20px;
  }

  .meet-scents__product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .meet-scents__product-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .meet-scents__product-placeholder-svg {
    width: 150px;
    height: 150px;
    opacity: 0.5;
  }

  .meet-scents__card-info {
    padding: 24px 20px 30px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    text-align: center;
  }

  .meet-scents__product-title {
    font-family: var(--font-sweet-sans);
    font-size: 20px;
    font-weight: 500;
    line-height: normal;
    letter-spacing: -0.2px;
    text-transform: uppercase;
    color: #3E2027;
    margin: 0;
  }

  .meet-scents__product-description {
    font-family: var(--font-jokker);
    font-size: 16px;
    font-weight: 400;
    line-height: 1.5;
    color: #3E2027;
    margin: 0;
  }

  .meet-scents__tabs {
    display: flex;
    flex-direction: column;
    margin-left: 0;
  }

  .meet-scents__tab {
    position: relative;
    width: 40px;
    height: 100px;
    padding: 12px 10px;
    margin-top: -8px;
    border: none;
    border-radius: 0 10px 10px 0;
    font-family: var(--font-sweet-sans);
    font-size: 10px;
    font-weight: 500;
    line-height: normal;
    letter-spacing: -0.1px;
    text-transform: uppercase;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.3s ease, color 0.3s ease;
    background-color: var(--tab-color);
    color: var(--tab-text-color, #FFFAE6);
    writing-mode: vertical-rl;
    text-orientation: mixed;
    z-index: var(--tab-z-index, 0);
  }

  .meet-scents__tab:first-child {
    margin-top: 0;
  }

  .meet-scents__tab.is-active {
    background-color: #FFFFFF;
    color: #3E2027;
    z-index: 10;
  }

  .meet-scents__tab:focus-visible {
    outline: 2px solid #3E2027;
    outline-offset: 2px;
    z-index: 1;
  }

  .meet-scents__tab-text {
    display: block;
  }

  .meet-scents__dots {
    display: flex;
    justify-content: center;
    gap: 4px;
  }

  .meet-scents__dot {
    width: 12px;
    height: 12px;
    border-radius: 20px;
    background-color: #FFFFFF;
    border: none;
    padding: 0;
    cursor: pointer;
    transition: width 0.3s ease, background-color 0.3s ease;
  }

  .meet-scents__dot.is-active {
    width: 24px;
    background-color: transparent;
    border: 1px solid #FFFFFF;
  }

  .meet-scents__dot:focus-visible {
    outline: 2px solid #3E2027;
    outline-offset: 2px;
  }

  @media (max-width: 1200px) {
    .meet-scents__heading {
      font-size: 56px;
    }

    .meet-scents__right {
      padding: 50px 70px 50px 30px;
    }

    .meet-scents__card {
      width: 320px;
      height: 540px;
    }

    .meet-scents__card-image {
      width: 288px;
      height: 370px;
    }
  }

  @media (max-width: 1024px) {
    .meet-scents__heading {
      font-size: 48px;
      left: 24px;
      right: 24px;
      bottom: 30px;
    }

    .meet-scents__right {
      padding: 40px 60px 40px 24px;
    }

    .meet-scents__card {
      width: 280px;
      height: 480px;
      border-radius: 16px 0 16px 16px;
    }

    .meet-scents__card-image {
      width: 252px;
      height: 320px;
      border-radius: 16px;
    }

    .meet-scents__card-info {
      padding: 20px 14px 24px;
    }

    .meet-scents__product-title {
      font-size: 18px;
    }

    .meet-scents__product-description {
      font-size: 14px;
    }

    .meet-scents__tab {
      width: 36px;
      height: 85px;
      padding: 10px 8px;
      font-size: 9px;
    }
  }

  .meet-scents__mobile-heading {
    display: none;
  }

  @media (max-width: 768px) {
    .meet-scents {
      padding: 40px 12px 60px;
    }

    .meet-scents__mobile-heading {
      display: block;
      font-family: var(--font-alyona);
      font-size: 30px;
      font-weight: 400;
      line-height: 1;
      text-align: center;
      color: #3E2027;
      margin: 0 0 24px;
    }

    .meet-scents__container {
      display: flex;
      justify-content: center;
      min-height: auto;
      margin: 0;
    }

    .meet-scents__left {
      display: none;
    }

    .meet-scents__right {
      position: static;
      padding: 0;
      background: none;
      overflow: visible;
    }

    .meet-scents__bg-image,
    .meet-scents__bg-placeholder {
      display: none;
    }

    .meet-scents__content {
      gap: 0;
    }

    .meet-scents__card-wrapper {
      min-height: auto;
    }

    .meet-scents__cards {
      min-height: auto;
    }

    .meet-scents__card {
      width: calc(100vw - 24px - 40px);
      max-width: 336px;
      height: auto;
      padding: 20px 20px 30px;
      border-radius: 20px 0 20px 20px;
    }

    .meet-scents__card-image {
      width: 100%;
      height: auto;
      aspect-ratio: 336 / 420;
    }

    .meet-scents__card-info {
      padding: 30px 0 0;
    }

    .meet-scents__product-title {
      font-size: 20px;
    }

    .meet-scents__product-description {
      font-size: 16px;
    }

    .meet-scents__tabs {
      margin-left: 0;
    }

    .meet-scents__tab {
      width: 40px;
      height: 90px;
      padding: 10px;
      font-size: 10px;
    }

    .meet-scents__dots {
      display: none;
    }
  }
{% endstylesheet %}

{% javascript %}
  class MeetScentsSection extends HTMLElement {
    constructor() {
      super();
      this.currentIndex = 0;
    }

    connectedCallback() {
      this.tabs = this.querySelectorAll('[data-tab]');
      this.cards = this.querySelectorAll('[data-card]');
      this.dots = this.querySelectorAll('[data-dot]');
      this.initTabs();
      this.initDots();
    }

    initTabs() {
      this.tabs.forEach((tab, index) => {
        tab.addEventListener('click', () => this.goTo(index));
        tab.addEventListener('keydown', (e) => this.handleKeydown(e, index));
      });
    }

    initDots() {
      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goTo(index));
      });
    }

    handleKeydown(e, currentIndex) {
      let newIndex = currentIndex;
      if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
        e.preventDefault();
        newIndex = (currentIndex + 1) % this.tabs.length;
      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
        e.preventDefault();
        newIndex = (currentIndex - 1 + this.tabs.length) % this.tabs.length;
      } else if (e.key === 'Home') {
        e.preventDefault();
        newIndex = 0;
      } else if (e.key === 'End') {
        e.preventDefault();
        newIndex = this.tabs.length - 1;
      }
      if (newIndex !== currentIndex) {
        this.goTo(newIndex);
        this.tabs[newIndex].focus();
      }
    }

    goTo(index) {
      this.tabs.forEach((tab, i) => {
        const isActive = i === index;
        tab.classList.toggle('is-active', isActive);
        tab.setAttribute('aria-selected', isActive ? 'true' : 'false');
      });
      this.cards.forEach((card, i) => {
        const isActive = i === index;
        card.classList.toggle('is-active', isActive);
        card.setAttribute('aria-hidden', isActive ? 'false' : 'true');
        card.setAttribute('tabindex', isActive ? '0' : '-1');
      });
      this.dots.forEach((dot, i) => {
        const isActive = i === index;
        dot.classList.toggle('is-active', isActive);
        dot.setAttribute('aria-current', isActive ? 'true' : 'false');
      });
      this.currentIndex = index;
    }

  }

  if (!customElements.get('meet-scents-section')) {
    customElements.define('meet-scents-section', MeetScentsSection);
  }
{% endjavascript %}

{% schema %}
{
  "name": "t:sections.meet_scents.name",
  "tag": "section",
  "class": "meet-scents-section",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.meet_scents.settings.content_header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:labels.heading",
      "default": "Meet Your Scents"
    },
    {
      "type": "header",
      "content": "t:sections.meet_scents.settings.images_header"
    },
    {
      "type": "image_picker",
      "id": "side_image",
      "label": "t:sections.meet_scents.settings.side_image",
      "info": "t:sections.meet_scents.settings.side_image_info"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "t:sections.meet_scents.settings.background_image",
      "info": "t:sections.meet_scents.settings.background_image_info"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "t:blocks.product.name",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "t:labels.product"
        },
        {
          "type": "color",
          "id": "tab_color",
          "label": "t:sections.meet_scents.settings.tab_color",
          "default": "#FFCAD2"
        },
        {
          "type": "color",
          "id": "tab_text_color",
          "label": "t:sections.meet_scents.settings.tab_text_color",
          "default": "#FFFAE6"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "t:sections.meet_scents.name"
    }
  ]
}
{% endschema %}
